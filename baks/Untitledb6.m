aa=[153712	3719429	34	1	10.79432715
4712	2655730	35	1	12.11622257
13128	1966624	36	1.5	13.6
3464	2030331	37	1.75	15.26548386
10824	2032833	38	1.875	17.13492628
2744	2098501	39	1.9375	19.23330445
10152	2114938	39	1.96875	19.23330445
2312	2169046	40	1.984375	21.58865431
13648	2225850	38	1.992188	17.13492628
2656	2218402	39	1.996094	19.23330445
17528	2184330	37	1.998047	15.26548386
3512	2221710	38	1.999023	17.13492628
16760	2186969	37	1.999512	15.26548386
3360	2224356	38	1.999756	17.13492628
18120	2196879	37	1.999878	15.26548386
3864	2245565	38	1.999939	17.13492628
24224	2212275	36	1.999969	13.6
4688	2254386	37	1.999985	15.26548386
22016	2178245	36	1.999992	13.6
4600	2237006	37	1.999996	15.26548386
24464	2191517	36	1.999998	13.6
5384	2276434	37	1.999999	15.26548386
24160	2241861	36	2	13.6
6328	2325168	37	2	15.26548386
21728	2251243	37	2	15.26548386
5744	2383180	38	2	17.13492628
24472	2318399	37	2	15.26548386
6288	2421832	38	2	17.13492628
27784	2390313	37	2	15.26548386
5952	2508480	38	2	17.13492628
27696	2420237	37	2	15.26548386
6128	2490801	38	2	17.13492628
28464	2427163	37	2	15.26548386
6224	2552294	38	2	17.13492628
26880	2426172	37	2	15.26548386
6216	2502258	38	2	17.13492628
21952	2452709	38	2	17.13492628
5576	2532639	39	2	19.23330445
24624	2539306	38	2	17.13492628
5432	2651668	39	2	19.23330445
26872	2599633	38	2	17.13492628
6232	2712242	39	2	19.23330445
27736	2679631	38	2	17.13492628
6272	2795265	39	2	19.23330445
27528	2704177	38	2	17.13492628
6544	2843183	39	2	19.23330445
28232	2713315	38	2	17.13492628
6440	2866096	39	2	19.23330445
21192	2721122	39	2	19.23330445
5216	2801502	40	2	21.58865431
19552	2758692	39	2	19.23330445
4992	2802680	40	2	21.58865431
21992	2806932	39	2	19.23330445
4896	2903347	40	2	21.58865431
22616	2802375	39	2	19.23330445
4920	2930249	40	2	21.58865431
20136	2741535	39	2	19.23330445
4840	2869146	40	2	21.58865431
20424	2695398	39	2	19.23330445
5016	2844012	40	2	21.58865431
78760	3561803	39	1.5	19.23330445
4832	3327755	41	2	24.23244513
15768	2726694	40	2	21.58865431
4296	2798424	41	2	24.23244513
22696	2764015	39	2	19.23330445
5168	2876487	40	2	21.58865431
22920	2761583	39	2	19.23330445
5336	2892024	40	2	21.58865431
22232	2809621	39	2	19.23330445
5536	2955522	40	2	21.58865431
22896	2779020	39	2	19.23330445
5888	2912540	40	2	21.58865431
21616	2820355	39	2	19.23330445
5696	2911249	40	2	21.58865431
21344	2819038	39	2	19.23330445
6256	2839272	40	2	21.58865431
22488	2815053	39	2	19.23330445
5376	2830647	40	2	21.58865431
20960	2758076	39	2	19.23330445
5592	2813090	40	2	21.58865431
21120	2768760	39	2	19.23330445
5336	2776865	40	2	21.58865431
20008	2672618	39	2	19.23330445
5016	2671747	40	2	21.58865431
19208	2616897	39	2	19.23330445
4504	2648318	40	2	21.58865431
19584	2583343	39	2	19.23330445
5288	2705570	40	2	21.58865431
22472	2656671	39	2	19.23330445
4720	2794292	40	2	21.58865431
21408	2646149	39	2	19.23330445
5000	2723512	40	2	21.58865431
19064	2598442	39	2	19.23330445
4152	2617975	40	2	21.58865431
18256	2576470	39	2	19.23330445
4128	2662434	40	2	21.58865431
18904	2620055	39	2	19.23330445
4056	2755174	40	2	21.58865431
19288	2620198	39	2	19.23330445
4560	2692506	40	2	21.58865431
18424	2716321	39	2	19.23330445
4040	2738060	40	2	21.58865431
20104	2689604	39	2	19.23330445
4280	2750449	40	2	21.58865431
20712	2697421	39	2	19.23330445
4776	2794222	40	2	21.58865431
21336	2736395	39	2	19.23330445
4720	2858776	40	2	21.58865431
19712	2695042	39	2	19.23330445
4592	2793299	40	2	21.58865431
20200	2681351	39	2	19.23330445
4880	2781872	40	2	21.58865431
19824	2698788	39	2	19.23330445
4704	2765360	40	2	21.58865431
20200	2709871	39	2	19.23330445
4856	2849210	40	2	21.58865431
18968	2730213	39	2	19.23330445
4608	2794103	40	2	21.58865431
18312	2727288	39	2	19.23330445
4064	2747034	40	2	21.58865431
71784	4355604	39	1.75	19.23330445
3152	3200406	41	2	24.23244513
15256	2560901	39	2	19.23330445
4280	2617789	40	2	21.58865431
18760	2634676	39	2	19.23330445
4072	2686824	40	2	21.58865431
18944	2611306	39	2	19.23330445
3952	2739532	40	2	21.58865431
18736	2623275	39	2	19.23330445
4040	2727720	40	2	21.58865431
17808	2671172	39	2	19.23330445
3472	2808934	40	2	21.58865431
16912	2657178	39	2	19.23330445
3152	2732426	40	2	21.58865431
16288	2644193	39	2	19.23330445
2728	2701864	40	2	21.58865431
14976	2612258	39	2	19.23330445
2816	2695350	40	2	21.58865431
19904	2629278	38	2	17.13492628
3624	2688988	39	2	19.23330445
19056	2593608	38	2	17.13492628
3832	2655215	39	2	19.23330445
16720	2573870	38	2	17.13492628
3824	2619525	39	2	19.23330445
17576	2589299	38	2	17.13492628
3768	2583073	39	2	19.23330445
16192	2551298	38	2	17.13492628
3472	2573888	39	2	19.23330445
16056	2540198	38	2	17.13492628
3688	2564580	39	2	19.23330445
17488	2531707	38	2	17.13492628
3552	2567245	39	2	19.23330445
17176	2539213	38	2	17.13492628
3152	2584532	39	2	19.23330445
16656	2503945	38	2	17.13492628
3064	2531776	39	2	19.23330445
17032	2525097	38	2	17.13492628
3624	2565796	39	2	19.23330445
17472	2517024	38	2	17.13492628
3224	2547846	39	2	19.23330445
15544	2508881	38	2	17.13492628
3216	2530993	39	2	19.23330445
15744	2502175	38	2	17.13492628
3056	2544113	39	2	19.23330445
17704	2512303	38	2	17.13492628
3320	2550347	39	2	19.23330445
17424	2546533	38	2	17.13492628
3536	2566441	39	2	19.23330445
17376	2542012	38	2	17.13492628
3160	2583107	39	2	19.23330445
17744	2534477	38	2	17.13492628
3152	2579212	39	2	19.23330445
24144	2532614	37	2	15.26548386
3384	2567070	38	2	17.13492628
19152	2458602	37	2	15.26548386
4000	2510894	38	2	17.13492628
20120	2455741	37	2	15.26548386
3384	2527021	38	2	17.13492628
21704	2449947	37	2	15.26548386
3824	2482277	38	2	17.13492628
84360	4069098	38	1.875	17.13492628
3064	2941067	39	2	19.23330445
12592	2434790	38	2	17.13492628
3032	2444508	39	2	19.23330445
14944	2457670	38	2	17.13492628
2936	2509424	39	2	19.23330445
14840	2462657	38	2	17.13492628
3016	2508590	39	2	19.23330445
18584	2464401	37	2	15.26548386
3368	2478905	38	2	17.13492628
15952	2391013	37	2	15.26548386
2728	2412305	38	2	17.13492628
14240	2350611	37	2	15.26548386
2256	2394961	38	2	17.13492628
13696	2303390	37	2	15.26548386
2216	2335781	38	2	17.13492628
13040	2286787	37	2	15.26548386
2360	2322493	38	2	17.13492628
14784	2298666	37	2	15.26548386
2896	2339206	38	2	17.13492628
14664	2312802	37	2	15.26548386
3224	2318164	38	2	17.13492628
13920	2301437	37	2	15.26548386
2656	2311408	38	2	17.13492628
13976	2286271	37	2	15.26548386
2400	2299094	38	2	17.13492628
12784	2257275	37	2	15.26548386
2552	2270343	38	2	17.13492628
12784	2260883	37	2	15.26548386
2624	2259549	38	2	17.13492628
19008	2222099	36	2	13.6
2960	2233164	37	2	15.26548386
15248	2166893	36	2	13.6
2544	2176519	37	2	15.26548386
13232	2126254	36	2	13.6
2632	2145114	37	2	15.26548386
15664	2111287	36	2	13.6
2464	2129130	37	2	15.26548386
12816	2083782	36	2	13.6
2504	2105725	37	2	15.26548386
13208	2063002	36	2	13.6
2512	2087736	37	2	15.26548386
13648	2052939	36	2	13.6
2584	2076613	37	2	15.26548386
13248	2044750	36	2	13.6
2656	2079458	37	2	15.26548386
14112	2050352	36	2	13.6
2656	2069784	37	2	15.26548386
13080	2026710	36	2	13.6
2456	2046607	37	2	15.26548386
18664	2007220	35	2	12.11622257
2952	2019289	36	2	13.6
15600	1943862	35	2	12.11622257
2880	1971283	36	2	13.6
15592	1930029	35	2	12.11622257
2664	1954243	36	2	13.6
16344	1928338	35	2	12.11622257
2872	1948456	36	2	13.6
15072	1918813	35	2	12.11622257
2840	1931651	36	2	13.6
86968	3806160	36	1.9375	13.6
2528	2438274	37	2	15.26548386
13088	1936049	36	2	13.6
2760	1968940	37	2	15.26548386
18328	1965889	35	2	12.11622257
2840	1984732	36	2	13.6
16776	1930907	35	2	12.11622257
2608	1972611	36	2	13.6
14992	1915248	35	2	12.11622257
2456	1934614	36	2	13.6
14816	1896096	35	2	12.11622257
2512	1912577	36	2	13.6
13976	1877922	35	2	12.11622257
2416	1913168	36	2	13.6
15568	1872489	35	2	12.11622257
2448	1912497	36	2	13.6
14560	1875036	35	2	12.11622257
2296	1884543	36	2	13.6
13520	1860744	35	2	12.11622257
1992	1871872	36	2	13.6
12696	1838840	35	2	12.11622257
1656	1859142	36	2	13.6
12048	1827755	35	2	12.11622257
1832	1833865	36	2	13.6
11168	1820719	35	2	12.11622257
1960	1822833	36	2	13.6
17240	1799730	34	2	10.79432715
1912	1814640	35	2	12.11622257
14696	1756094	34	2	10.79432715
2272	1768075	35	2	12.11622257
13880	1743561	34	2	10.79432715
2120	1759175	35	2	12.11622257
14368	1724493	34	2	10.79432715
2208	1755955	35	2	12.11622257
13736	1719041	34	2	10.79432715
2256	1739392	35	2	12.11622257
14152	1709238	34	2	10.79432715
2200	1711613	35	2	12.11622257
13216	1691691	34	2	10.79432715
1928	1707073	35	2	12.11622257
12272	1679938	34	2	10.79432715
1912	1695166	35	2	12.11622257
12592	1680572	34	2	10.79432715
1776	1683811	35	2	12.11622257
12744	1666795	34	2	10.79432715
2408	1681060	35	2	12.11622257
12200	1662930	34	2	10.79432715
2552	1682443	35	2	12.11622257
13784	1673194	34	2	10.79432715
3040	1692646	35	2	12.11622257
20928	1674524	33	2	9.616652224
3160	1697946	34	2	10.79432715
18080	1634374	33	2	9.616652224
3160	1668813	34	2	10.79432715
16384	1624544	33	2	9.616652224
3088	1658441	34	2	10.79432715
18056	1623854	33	2	9.616652224
3032	1649282	34	2	10.79432715
16928	1607676	33	2	9.616652224
3024	1639445	34	2	10.79432715

];
bits=aa(:,1);
var=aa(:,2);
qscale=aa(:,5);
count=aa(:,4);
coeff=bits.*qscale./var.*count;
len=size(aa,1);
x=1:len;

%%
coeff_est=zeros(len,1);
coeff_est(1)=0.57;
coeff_est(2)=0.042;
coeff_est(3)=0.15;
bits_est=zeros(len,1);
bits_est(1)=var(1)*coeff_est(1)/count(1)/qscale(1);
bits_est(2)=var(2)*coeff_est(2)/count(2)/qscale(2);
bits_est(3)=var(3)*coeff_est(3)/count(3)/qscale(3);
fps=60;
for i=4:len
    if mod(i-1,fps)==0
        coeff_est(i)=coeff_est(i-fps)*0.5+bits(i-fps)*qscale(i-fps)/var(i-fps);
    else
    coeff_est(i)=coeff_est(i-2)*0.5+bits(i-2)*qscale(i-2)/var(i-2);
    end
    bits_est(i)=var(i)*coeff_est(i)/count(i)/qscale(i);    
end
%%
figure,
subplot(2,1,1)
grid on,hold on
plot(x,coeff,'b');
plot(x,coeff_est,'g')

subplot(2,1,2);
grid on,hold on
plot(x,bits,'b');
plot(x,bits_est,'g');

